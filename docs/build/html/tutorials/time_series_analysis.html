
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fourier Analysis of time series data &#8212; clif 0.2.0 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=84ace793992934648b4de8eed757e5a2" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="EOF Class" href="../api_fingerprints.html" />
    <link rel="prev" title="The preprocessing transforms" href="intro_to_preproc.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/clif_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">clif 0.2.0 documentation</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="getting_started.html">
   Getting started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../overview.html">
   Main features
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="first_look.html">
   First look at the data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intro_to_preproc.html">
   The preprocessing transforms
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Fourier Analysis of time series data
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  API
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../api_fingerprints.html">
   EOF Class
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../api_preprocessing.html">
   Preprocessing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../transforms.html">
     Transforms
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api_statistics.html">
   Statistical Tests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api_plotting.html">
   Plotting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../api_fourier.html">
   Time Series Analysis
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/tutorials/time_series_analysis.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/kennychowdhary/clif"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Fourier Analysis of time series data</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="fourier-analysis-of-time-series-data">
<h1>Fourier Analysis of time series data<a class="headerlink" href="#fourier-analysis-of-time-series-data" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we will go through a simple example of how to plot the
fft power spectrum for xarray time series data. We will use the
temperature data as a baseline and look at the time series for a
particular pressure elevation. Let’s go ahead and process the data as in
the previous tutorials.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Location of the data for loading</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">DATADIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;HOME&quot;</span><span class="p">),</span><span class="s2">&quot;Research/e3sm_data/fingerprint&quot;</span><span class="p">)</span>
<span class="n">DATAFILE</span> <span class="o">=</span> <span class="s2">&quot;Temperature.nc&quot;</span>
<span class="n">WEIGHTFILE</span><span class="o">=</span><span class="s2">&quot;lat_lon_weights.nc&quot;</span>

<span class="c1"># Load the data from the data directory, using dask to help manage the memory (optional)</span>
<span class="kn">import</span> <span class="nn">xarray</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATADIR</span><span class="p">,</span> <span class="n">DATAFILE</span><span class="p">))</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATADIR</span><span class="p">,</span> <span class="n">WEIGHTFILE</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s transform the data</span>
<span class="kn">import</span> <span class="nn">clif.preprocessing</span> <span class="k">as</span> <span class="nn">cpp</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="c1"># Create the transform pipeline</span>
<span class="n">transform_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;anomaly&quot;</span><span class="p">,</span> <span class="n">cpp</span><span class="o">.</span><span class="n">SeasonalAnomalyTransform</span><span class="p">()),</span>
        <span class="p">(</span><span class="s2">&quot;marginalize&quot;</span><span class="p">,</span> <span class="n">cpp</span><span class="o">.</span><span class="n">MarginalizeOutTransform</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">],</span> <span class="n">lat_lon_weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)),</span>
        <span class="p">(</span><span class="s2">&quot;transpose&quot;</span><span class="p">,</span> <span class="n">cpp</span><span class="o">.</span><span class="n">Transpose</span><span class="p">(</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;plev&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">])),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Get the transformed data</span>
<span class="n">data_new</span> <span class="o">=</span> <span class="n">transform_pipe</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, let’s extract the time_series for a particular pressure elevation
to obtain a single time series data array.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_series_data</span> <span class="o">=</span> <span class="n">data_new</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">plev</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">time_series_data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">144</span><span class="p">,)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let use the Fourier time series analysis class to look more closely at the signal</span>
<span class="kn">from</span> <span class="nn">clif</span> <span class="kn">import</span> <span class="n">FourierTimeSeriesAnalysis</span>
</pre></div>
</div>
<p>In order to initiate the class, we just need to give a base unit so that
we can automatically determine the sampling frequence, etc. Since the
data is monthly for 12 years, if we choose a base unit of ‘month’, the
sampling frequency will be 1 (1 sample per month), and if we choose a
base unit of ‘year’ the sampling frequency will be 12 (12 samples per
year). The only difference is in the interpretation of the power
spectrum at the end. For the purposes of this experiment, we will choose
a base unit of a year.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In order to initiate the class, we just need to give a base unit so that we can automatically determine the sampling frequency, etc.</span>
<span class="n">fourier</span> <span class="o">=</span> <span class="n">FourierTimeSeriesAnalysis</span><span class="p">(</span><span class="n">base_unit</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>

<span class="c1"># Now we simply fit the time series</span>
<span class="n">fourier</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">time_series_data</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s plot what the signal looks like</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">8.5</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fourier</span><span class="o">.</span><span class="n">t_</span><span class="p">,</span><span class="n">time_series_data</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta$&quot;</span> <span class="o">+</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u00b0</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;K&quot;</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">Text(0, 0.5, '$\Delta$°K')</pre>
<img alt="../_images/time_series_analysis_8_1.png" src="../_images/time_series_analysis_8_1.png" />
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Let&#39;s plot the power spectrum in frequency vs power</span>
<span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">fourier</span><span class="o">.</span><span class="n">plot_power_spectrum</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="n">logscale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
 <span class="c1">#We can also plot the period vs power</span>
<span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">fourier</span><span class="o">.</span><span class="n">plot_power_spectrum</span><span class="p">(</span><span class="n">xaxis</span><span class="o">=</span><span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="n">logscale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/time_series_analysis_9_0.png" src="../_images/time_series_analysis_9_0.png" />
<img alt="../_images/time_series_analysis_9_1.png" src="../_images/time_series_analysis_9_1.png" />
<p>Finally, we can also filter the signal to get a smoother function
without the high frequency modes.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove all frequencies greater than 2 cycles per year</span>
<span class="n">y_filtered</span> <span class="o">=</span> <span class="n">fourier</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">freq_cutoff</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig3</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">8.5</span><span class="p">,</span><span class="mf">4.0</span><span class="p">])</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fourier</span><span class="o">.</span><span class="n">t_</span><span class="p">,</span> <span class="n">y_filtered</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;filtered&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fourier</span><span class="o">.</span><span class="n">t_</span><span class="p">,</span> <span class="n">time_series_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;signal&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Delta$&quot;</span> <span class="o">+</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u00b0</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;K&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">Legend</span> <span class="n">at</span> <span class="mh">0x1445fad50</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="../_images/time_series_analysis_11_1.png" src="../_images/time_series_analysis_11_1.png" />
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="intro_to_preproc.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">The preprocessing transforms</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../api_fingerprints.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">EOF Class</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By K. Chowdhary<br/>
    
        &copy; Copyright 2022, K. Chowdhary.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>